<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>李笑来老板的re part</title>
      <link href="/2019/10/01/re/"/>
      <url>/2019/10/01/re/</url>
      
        <content type="html"><![CDATA[<h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><p>正则表达式本质上是个独立的语言，短小却格外强悍 —— 乃至于，如果你竟然没学会它的话，你的之前学的编程技能干脆与残疾无异。</p><p>Wikipedia 上对正则表达式的说明如下：</p><blockquote><p><strong>正则表达式</strong>（英语：Regular Expression，在代码中常简写为 regex、regexp 或 RE），又称<em>正规表示式</em>、<em>正规表示法</em>、<em>正规运算式</em>、<em>规则运算式</em>、<em>常规表示法</em>，是计算机科学的一个概念。正则表达式使用单个字符串来描述、匹配一系列符合某个句法规则的字符串。在很多文本编辑器里，正则表达式通常被用来检索、替换那些符合某个模式的文本。许多程序设计语言都支持利用正则表达式进行字符串操作。例如，在 Perl 中就内建了一个功能强大的正则表达式引擎。正则表达式这个概念最初是由 Unix 中的工具软件（例如 sed 和 grep）普及开的。</p></blockquote><p>以下是绝大多数翻译成中文的教程中对正则表达式进行讲解时所使用的描述：</p><blockquote><p>一个正则表达式（Regular Expression）通常被称为一个模式（Pattern）。</p></blockquote><p>我常常觉得当初要是它被翻译成 “规则表达式”，那么很可能初学者不会感到那么大的压力 —— 谁都一样，看着由 “每个都认识的字构成的词组” 却不能直观地想到它究竟是什么东西，都会感到莫名的压力。</p><p><strong>Regular</strong>，其实在它的众多语义中，取以下释义最符合 Regular Expression 的原意<a href="#fn1" name="fn1b"><sup>[1]</sup></a>：</p><blockquote><p>⑭ Linguistics 规则的 ▸ regular verbs 规则动词</p></blockquote><p>而 <strong>Pattern</strong> 这个词，在词典里有好几个对应的中文词汇：</p><blockquote><p>① 图案；② 式样；③ 图样；④ 榜样；⑤ 模式；⑥ 样品；⑦ 模子</p></blockquote><p>在当前语境之下，把 Pattern 翻译成 “模式”，显然不如 “模子” 更好（甚至连 “样品” 感觉都比 “模式” 更恰当）—— “模子” 这个词很直观啊，拿着一个模子去找与它一致的字符串…… “与规则一致”，英文用的是 <strong>Match</strong>，一般被翻译作 “匹配”。</p><p>在自学编程的过程中，处处都是这种语言翻译带来的迷惑、障碍，或者耽误。既然应该把 Regular Expression 理解为 “规则表达式” 更好，那其实吧，把 Pattern 直接理解为中文的 “<em>规则</em>”，可能更直观更准确，理解上更是毫无障碍：</p><blockquote><p>一个规则表达式（Regular Expression）通常被称为一个规则（Pattern）。</p></blockquote><p>那么，<strong>规则表达式</strong>里写的是什么呢？只能是<strong>规则</strong>了…… 到最后好像也就 “捕获”（Capture）这个词没什么歧义。</p><p>现在，我们已经把术语全部 “解密” 了，然后再看看下面的表述：</p><blockquote><p>我们可以用书写特定的规则，用来在文本中捕获与规则一致的字符串，而后对其进行操作……</p></blockquote><p>理解起来相当顺畅。</p><p>以下的 Python 代码中，<a href="https://regexper.com#%5Cwo%5Cw" target="_blank" rel="noopener"><code>\wo\w</code></a> 就是一个<em>规则表达式</em>（或称为<em>规则</em>）；</p><p>而 <code>re.findall(pttn, str)</code> 的作用就是，在 <code>str</code> 里找到所有与这个<strong>规则</strong>（Pattern，模式）<strong>一致</strong>（Match，匹配）的字符串：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">str = <span class="string">'The quick brown fox jumps over the lazy dog'</span></span><br><span class="line">pttn = re.compile(<span class="string">r'\wo\w'</span>)</span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;row&apos;, &apos;fox&apos;, &apos;dog&apos;]</code></pre><p>总结一下：</p><blockquote><p><strong>规则表达式</strong>（Regular Expressions，通常缩写为 Regex）是最强大且不可或缺的文本处理工具 —— 它的用处就是在文本中<strong>扫描/搜索</strong>（Scan/Search）与某一<strong>规则</strong>（Pattern）<strong>匹配</strong>（Match，即，与规则一致）的所有实例，并且还可以按照规则<strong>捕获</strong>（Capture）其中的部分或者全部，对它们进行<strong>替换</strong>（Replace）。</p></blockquote><p>接下来为了避免歧义，我们干脆用 Regex 这个缩写，以及与它相关的英文单词：pattern, match, capture, replace(ment)……</p><p>有时，使用 Regex 并不是为了 Replace，而是为了检查格式，比如，可以用 Regex 检查用户输入的密码是否过于简单（比如，全部都由数字构成），比如可以用来验证用户输入的电话号码、证件号码是否符合特定格式等等。</p><p>另外，在自学的过程中，想尽一切办法把一切术语用简单直白的 “人话” 重新表述，是特别有效的促进进步的行为模式。</p><h2 id="视觉体验"><a href="#视觉体验" class="headerlink" title="视觉体验"></a>视觉体验</h2><p>所谓百闻不如一见。</p><p>眼见为实 —— 想办法让一个陌生的概念视觉上直观，是突破大多学习障碍的最简单粗暴直接有效的方式。</p><p>我们最好先直接看看 Regex 的工作过程。以下，是用微软发行的代码编辑工具 Visual Studio Code 针对一小段文本使用若干条 Regex 进行匹配的过程：</p><p><img src="https://raw.githubusercontent.com/selfteaching/the-craft-of-selfteaching/master/images/regex-test.gif?raw=true" alt></p><p>Python 的项目代码仓库里有一个很简短的 Demo 程序，叫 <a href="https://github.com/python/cpython/blob/master/Tools/demo/redemo.py" target="_blank" rel="noopener"><code>redemo.py</code></a>，它使用 <a href="https://docs.python.org/3/library/tkinter.html" target="_blank" rel="noopener">Tcl/Tk</a> 作为图形界面，也可以用来测试正则表达式。</p><p>它的代码地址是：</p><blockquote><p><a href="https://raw.githubusercontent.com/python/cpython/master/Tools/demo/redemo.py" target="_blank" rel="noopener">https://raw.githubusercontent.com/python/cpython/master/Tools/demo/redemo.py</a></p></blockquote><p>它运行起来长成这样：</p><p><img src="https://raw.githubusercontent.com/selfteaching/the-craft-of-selfteaching/master/images/redemo.png?raw=true" alt></p><p>目前（2019）网上最方便的 Regex 测试器，是 <a href="https://regex101.com" target="_blank" rel="noopener">regex101.com</a>：</p><p>以下，就是在一段文本中，找出所有首写字母大写的词汇的<em>过程</em>，并将其先全部替换成小写，再将其全部替换为大写的过程；使用的正则表达式是 <code>([A-Z]\w+)</code>，替换表达式分别是 <code>\L$1</code> 和 <code>\U$1</code>：</p><p><img src="https://raw.githubusercontent.com/selfteaching/the-craft-of-selfteaching/master/images/regex101.gif?raw=true" alt></p><p>这个网站太好了，所以，平日里我是用 <a href="https://github.com/jiahaog/nativefier" target="_blank" rel="noopener">Nativefier</a> 工具将这个网站打包为一个 Mac Desktop App 使用。不过，它也有局限，就是被搜索文件略微大点就报错，说 <code>timeout</code>……</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>我们需要个文本文件，用来当作练习使用正则表达式去搜索替换的目标。这个文件保存在当前的根目录，文件名称是：<code>regex-target-text-sample.txt</code>。</p><p>以下代码中，<code>pttn = r&#39;beg[iau]ns?&#39;</code> 这一句中的 <a href="https://regexper.com#beg[iau]ns?" target="_blank" rel="noopener"><code>beg[iau]ns?</code></a> 就是 Regex 的 Pattern。</p><p><strong>注意</strong>：在 Python 代码中，写 Pattern 的时候，之所以要在字符串 <code>&#39;...&#39;</code> 之前加上 <code>r</code>，写成 <code>r&#39;...&#39;</code>，是因为如果不用 raw string 的话，那么，每个转义符号都要写成 <code>\\</code>；如果用 raw string，转义符号就可以直接使用 <code>\</code> 本身了…… 当然，如果你想搜索 <code>\</code> 这个符号本身的话，那么还是得写 <code>\\</code>。</p><p>而 <code>re.findall(pttn, str)</code> 的意思是说，把 <code>str</code> 中所有与 <code>pttn</code> 这个规则一致的字符串都找出来：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'regex-target-text-sample.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    str = f.read()</span><br><span class="line">pttn = <span class="string">r'beg[iau]ns?'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;begin&apos;, &apos;began&apos;, &apos;begun&apos;, &apos;begin&apos;]</code></pre><p>文件 <code>regex-target-text-sample.txt</code> 中的内容如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span>begin began begun bigins begining<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span>google gooogle goooogle goooooogle<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span>coloured color coloring  colouring colored<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span>never ever verb however everest<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span>520 52000 5200000 520000000 520000000000<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span>error wonderer achroiocythaemia achroiocythemia<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span>The white dog wears a black hat.<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span>Handel, Händel, Haendel<span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span>(843) 542-4256<span class="tag">&lt;/<span class="name">dl</span>&gt;</span> <span class="tag">&lt;<span class="name">dl</span>&gt;</span>(431) 270-9664<span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span>3336741162<span class="tag">&lt;/<span class="name">dl</span>&gt;</span> <span class="tag">&lt;<span class="name">dl</span>&gt;</span>3454953965<span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>peoplesr@live.com<span class="tag">&lt;/<span class="name">li</span>&gt;</span> <span class="tag">&lt;<span class="name">li</span>&gt;</span>jaxweb@hotmail.com<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>dhwon@comcast.net<span class="tag">&lt;/<span class="name">li</span>&gt;</span> <span class="tag">&lt;<span class="name">li</span>&gt;</span>krueger@me.com<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>URLs<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">https://docs.python.org/3/howto/regex.html</span><br><span class="line">https://docs.python.org/3/library/re.html</span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>passwords<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">Pasw0rd~</span><br><span class="line">i*Eh,GF67E</span><br><span class="line">a$4Bh9XE&amp;E</span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>duplicate words<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>It's very very big.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Keep it simple, simple, simple!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在以下的示例中，有时直接设定了 str 的值，而不是使用以上整个文本文件 —— 因为读者在阅读的时候，最好能直接看到被搜索的字符串。另外，如果使用整个文件，所得到的 Match 太多，也确实影响阅读。</p><h2 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h2><p>毕竟，你已经不是 “啥都不懂” 的人了。你已经知道一个事实：编程语言无非是用来运算的。</p><p>所谓的运算，就有操作符（Operators）和操作元（Operands）—— 而操作符肯定是有优先级的，不然的话，那么多操作元和操作符放在一起，究竟先操作哪个呢？</p><p>Regex 也一样，它本身就是个迷你语言（Mini Language）。在 Regex 中，操作符肯定也有优先级。它的操作元有个专门的名称，<strong>原子</strong>（Atom）。</p><p>先大致看看它的操作符优先级，你就会对它有相当不错的了解：</p><table><thead><tr><th>排列</th><th>原子与操作符优先级</th><th>（从高到低）</th></tr></thead><tbody><tr><td>1</td><td>转义符号 (Escaping Symbol)</td><td><code>\</code></td></tr><tr><td>2</td><td>分组、捕获 (Grouping or Capturing)</td><td><code>(...)</code> <code>(?:...)</code> <code>(?=...)</code> <code>(?!...)</code> <code>(?&lt;=...)</code> <code>(?&lt;!...)</code></td></tr><tr><td>3</td><td>数量 (Quantifiers)</td><td><code>a*</code> <code>a+</code> <code>a?</code> <code>a{n, m}</code></td></tr><tr><td>4</td><td>序列与定位（Sequence and Anchor）</td><td><code>abc</code> <code>^</code> <code>$</code> <code>\b</code> <code>\B</code></td></tr><tr><td>5</td><td>或（Alternation）</td><td><code>a|b|c</code></td></tr><tr><td>6</td><td>原子 (Atoms)</td><td><code>a</code> <code>[^abc]</code> <code>\t</code> <code>\r</code> <code>\n</code> <code>\d</code> <code>\D</code> <code>\s</code> <code>\S</code> <code>\w</code> <code>\W</code> <code>.</code></td></tr></tbody></table><p>当然，你若是在之前，没有自学过、理解过 Python（或者任何其它编程语言）表达式中的操作符优先级，那么一上来就看上面的表格不仅对你没有帮助，只能让你更迷惑。</p><p>—— 这就是理解能力逐步积累逐步加强的过程。</p><h2 id="原子"><a href="#原子" class="headerlink" title="原子"></a>原子</h2><p>在 Regex 的 Pattern 中，操作元，即，被运算的 “值”，被称为<strong>原子</strong>（Atom）。</p><h3 id="本义字符"><a href="#本义字符" class="headerlink" title="本义字符"></a>本义字符</h3><p>最基本的原子，就是本义字符，它们都是单个字符。</p><p>本义字符包括从 <code>a</code> 到 <code>z</code>，<code>A</code> 到 <code>Z</code>，<code>0</code> 到 <code>9</code>，还有 <code>_</code> —— 它们所代表的就是它们的字面值。</p><p>即，相当于，<code>string.ascii_letters</code> 和 <code>string.digits</code> 以及 <code>_</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">string.ascii_letters</span><br><span class="line">string.digits</span><br></pre></td></tr></table></figure><pre><code>&apos;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&apos;&apos;0123456789&apos;</code></pre><p>以下字符在 Regex 中都有特殊含义：</p><blockquote><p><code>\</code> <code>+</code> <code>*</code> <code>.</code> <code>?</code> <code>-</code> <code>^</code> <code>$</code> <code>|</code> <code>(</code> <code>)</code> <code>[</code> <code>]</code> <code>{</code> <code>}</code> <code>&lt;</code> <code>&gt;</code></p></blockquote><p>当你在写 Regex 的时候，如果你需要搜索的字符不是本义字符，而是以上这些特殊字符时，<em>建议</em>都直接加上转义符号 <code>\</code> 来表示，比如，你想搜索 <code>&#39;</code>，那你就写 <code>\&#39;</code>，或者你想搜索 <code>#</code> 那你就写 <code>\#</code>（事实上，<code>#</code> 并不是 Regex 的特殊符号，所以，它之前的转义符号可有可无）—— 这对初学者来说可能是最安全的策略。</p><p>跟过往一样，所有的细节都很重要，它们就是需要花时间逐步熟悉到牢记。</p><h3 id="集合原子"><a href="#集合原子" class="headerlink" title="集合原子"></a>集合原子</h3><p>集合原子还是原子。</p><p>标示集合原子，使用方括号 <code>[]</code>。<code>[abc]</code> 的意思是说，“<code>a</code> or <code>b</code> or <code>c</code>”，即，<code>abc</code> 中的任意一个字符。</p><p>比如，<a href="https://regexper.com#beg[iau]n" target="_blank" rel="noopener"><code>beg[iau]n</code></a> 能够代表 <code>begin</code>、<code>began</code>，以及 <code>begun</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">str = <span class="string">'begin began begun bigins begining'</span></span><br><span class="line">pttn = <span class="string">r'beg[iau]n'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;begin&apos;, &apos;began&apos;, &apos;begun&apos;, &apos;begin&apos;]</code></pre><p>在方括号中，我们可以使用两个操作符：<code>-</code>（区间）和 <code>^</code>（非）。</p><ul><li><code>[a-z]</code> 表示从小写字母 <code>a</code> 到小写字母 <code>z</code> 中的任意一个字符。</li><li><code>[^abc]</code> 表示 <code>abc</code> 以外的其它任意字符，即，非 <code>[abc]</code>。</li></ul><p>注意，一个集合原子中，<code>^</code> 符号只能用一次，只能紧跟在 <code>[</code> 之后。否则不起作用。</p><h3 id="类别原子"><a href="#类别原子" class="headerlink" title="类别原子"></a>类别原子</h3><p>类别原子，是指那些能够代表 “一类字符” 的原子，它们都得使用转义符号再加上另外一个符号表达，包括：</p><p><code>\d</code> 任意数字；等价于 <code>[0-9]</code></p><p><code>\D</code> 任意非数字；等价于 <code>[^0-9]</code></p><p><code>\w</code> 任意本义字符；等价于 <code>[a-zA-Z0-9_]</code></p><p><code>\W</code> 任意非本义字符；等价于 <code>[^a-zA-Z0-9_]</code></p><p><code>\s</code> 任意空白；相当于 <code>[ \f\n\r\t\v]</code>（注意，方括号内第一个字符是空格符号）</p><p><code>\S</code> 任意非空白；相当于 <code>[^ \f\n\r\t\v]</code>（注意，紧随 <code>^</code> 之后的是一个空格符号）</p><p><code>.</code> 除 <code>\r</code> <code>\n</code> 之外的任意字符；相当于 <code>[^\r\n]</code></p><p>类别原子挺好记忆的，如果你知道各个字母是哪个词的首字母的话：</p><blockquote><ul><li><code>d</code> 是 digits</li><li><code>w</code> 是 word characters</li><li><code>s</code> 是 spaces</li></ul></blockquote><p>另外，在空白的集合 <code>[ \f\n\r\t\v]</code> 中：<code>\f</code> 是分页符；<code>\n</code> <code>\r</code> 是换行符；<code>\t</code> 是制表符；<code>\v</code> 是纵向制表符（很少用到）。各种关于空白的转义符也同样挺好记忆的，如果你知道各个字母是那个词的首字母的话：</p><blockquote><ul><li><code>f</code> 是 flip</li><li><code>n</code> 是 new line</li><li><code>r</code> 是 return</li><li><code>t</code> 是 tab</li><li><code>v</code> 是 vertical tab</li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">str = <span class="string">'&lt;dl&gt;(843) 542-4256&lt;/dl&gt; &lt;dl&gt;(431) 270-9664&lt;/dl&gt;'</span></span><br><span class="line">pttn = <span class="string">r'\d\d\d\-'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;542-&apos;, &apos;270-&apos;]</code></pre><h3 id="边界原子"><a href="#边界原子" class="headerlink" title="边界原子"></a>边界原子</h3><p>我们可以用边界原子指定边界。也可以称作 “定位操作符”。</p><p><code>^</code> 匹配被搜索字符串的开始位置；</p><p><code>$</code> 匹配被搜索字符串的结束位置；</p><p><code>\b</code> 匹配单词的边界；<a href="https://regexper.com#er%5Cb" target="_blank" rel="noopener"><code>er\b</code></a>，能匹配 <code>coder</code> 中的 <code>er</code>，却不能匹配 <code>error</code> 中的 <code>er</code>；</p><p><code>\B</code> 匹配非单词边界；<a href="https://regexper.com#er%5CB" target="_blank" rel="noopener"><code>er\B</code></a>，能匹配 <code>error</code> 中的 <code>er</code>，却不能匹配 <code>coder</code> 中的 <code>er</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">str = <span class="string">'never ever verb however everest'</span></span><br><span class="line">pttn = <span class="string">r'er\b'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line">pttn = <span class="string">r'er\B'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;er&apos;, &apos;er&apos;, &apos;er&apos;][&apos;er&apos;, &apos;er&apos;]</code></pre><p><strong>注意</strong>：<code>^</code> 和 <code>$</code> 在 Python 语言中被 <code>\A</code> 和 <code>\Z</code> 替代。</p><p>事实上，每种语言或多或少都对 Regex 有自己的定制。不过，本章讨论的绝大多数细节，都是通用的。</p><h3 id="组合原子"><a href="#组合原子" class="headerlink" title="组合原子"></a>组合原子</h3><p>我们可以用圆括号 <code>()</code> 将多个单字符原子组合成一个原子 —— 这么做的结果是，<code>()</code> 内的字符串将被当作一整个原子，可以被随后我们要讲解的数量操作符操作。</p><p>另外，<code>()</code> 这个操作符，有两个作用：<strong>组合</strong>（Grouping），就是我们刚刚讲到的作用；而另外一个作用是<strong>捕获</strong>（Capturing)，后面会讲到。</p><p>注意区别，<a href="https://regexper.com#er" target="_blank" rel="noopener"><code>er</code></a>、<a href="https://regexper.com#[er]" target="_blank" rel="noopener"><code>[er]</code></a> 和 <a href="https://regexper.com#(er" target="_blank" rel="noopener"><code>(er)</code></a> 各不相同。</p><blockquote><ul><li><code>er</code> 是两个原子，<code>&#39;e&#39;</code> 和紧随其后的 <code>&#39;r&#39;</code></li><li><code>[er]</code> 是一个原子，或者 <code>&#39;e&#39;</code> 或者 <code>&#39;r&#39;</code>；</li><li><code>(er)</code> 是一个原子，<code>&#39;er&#39;</code></li></ul></blockquote><p>下一节中讲到数量操作符的时候，会再次强调这点。</p><h2 id="数量操作符"><a href="#数量操作符" class="headerlink" title="数量操作符"></a>数量操作符</h2><p>数量操作符有：<code>+</code> <code>?</code> <code>*</code> <code>{n, m}</code>。</p><p>它们是用来限定位于它们之前的原子允许出现的个数；不加数量限定则代表出现一次且仅出现一次：</p><p><code>+</code> 代表前面的原子必须至少出现一次，即：<code>出现次数 ≧ 1</code></p><blockquote><p>例如，<a href="https://regexper.com#go+gle" target="_blank" rel="noopener"><code>go+gle</code></a>可以匹配 <code>google</code> <code>gooogle</code> <code>goooogle</code> 等；</p></blockquote><p><code>?</code> 代表前面的原子最多只可以出现一次，即：<code>0 ≦ 出现次数 ≦ 1</code></p><blockquote><p>例如，<a href="https://regexper.com#colou?red" target="_blank" rel="noopener"><code>colou?red</code></a>可以匹配 <code>colored</code> 或者 <code>coloured</code>;</p></blockquote><p><code>*</code> 代表前面的原子可以不出现，也可以出现一次或者多次，即：<code>出现次数 ≧ 0</code></p><blockquote><p>例如，<a href="https://regexper.com#520*" target="_blank" rel="noopener"><code>520*</code></a>可以匹配 <code>52</code> <code>520</code> <code>52000</code> <code>5200000</code> <code>520000000000</code> 等。</p></blockquote><p><code>{n}</code> 之前的原子出现确定的 <code>n</code> 次；</p><p><code>{n,}</code> 之前的原子出现至少 <code>n</code> 次；</p><p><code>{n, m}</code> 之前的原子出现至少 <code>n</code> 次，至多 <code>m</code> 次</p><blockquote><p>例如，<a href="https://regexper.com#go%7B2,5%7Dgle" target="_blank" rel="noopener"><code>go{2,5}gle</code></a>，能匹配 <code>google</code> <code>gooogle</code> <code>goooogle</code> 或 <code>gooooogle</code>，但不能匹配 <code>gogle</code> 和 <code>gooooooogle</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'regex-target-text-sample.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    str = f.read()</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'go+gle'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'go&#123;2,5&#125;gle'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'colou?red'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'520*'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;google&apos;, &apos;gooogle&apos;, &apos;goooogle&apos;, &apos;goooooogle&apos;][&apos;google&apos;, &apos;gooogle&apos;, &apos;goooogle&apos;][&apos;coloured&apos;, &apos;colored&apos;][&apos;520&apos;, &apos;52000&apos;, &apos;5200000&apos;, &apos;520000000&apos;, &apos;520000000000&apos;]</code></pre><p>数量操作符是对它之前的原子进行操作的，换言之，数量操作符的操作元是操作符之前的原子。</p><p>上一节提到，要注意区别：<code>er</code>、<code>[er]</code> 和 <code>(er)</code> 各不相同。</p><blockquote><ul><li><code>er</code> 是两个原子，<code>&#39;e&#39;</code> 之后 <code>&#39;r&#39;</code></li><li><code>[er]</code> 是一个原子，或者 <code>&#39;e&#39;</code> 或者 <code>&#39;r&#39;</code>；</li><li><code>(er)</code> 是一个原子，<code>&#39;er&#39;</code></li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">str = <span class="string">'error wonderer severeness'</span></span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'er'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'[er]'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'(er)'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;er&apos;, &apos;er&apos;, &apos;er&apos;, &apos;er&apos;][&apos;e&apos;, &apos;r&apos;, &apos;r&apos;, &apos;r&apos;, &apos;e&apos;, &apos;r&apos;, &apos;e&apos;, &apos;r&apos;, &apos;e&apos;, &apos;e&apos;, &apos;r&apos;, &apos;e&apos;, &apos;e&apos;][&apos;er&apos;, &apos;er&apos;, &apos;er&apos;, &apos;er&apos;]</code></pre><p>在以上的例子中，看不出 <code>er</code> 和 <code>(er)</code> 的区别，但是，加上数量操作符就不一样了 —— 因为<em>数量操作符只对它之前的那一个原子进行操作</em>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">str = <span class="string">'error wonderer severeness'</span></span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'er+'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'[er]+'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'(er)+'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;err&apos;, &apos;er&apos;, &apos;er&apos;, &apos;er&apos;][&apos;err&apos;, &apos;r&apos;, &apos;erer&apos;, &apos;e&apos;, &apos;ere&apos;, &apos;e&apos;][&apos;er&apos;, &apos;er&apos;, &apos;er&apos;]</code></pre><h2 id="或操作符"><a href="#或操作符" class="headerlink" title="或操作符 |"></a>或操作符 <code>|</code></h2><p>或操作符 <code>|</code> 是所有操作符中优先级最低的，数量操作符的优先级比它高，所以，在 <code>|</code> 前后的原子被数量操作符（如果有的话）操作之后才交给 <code>|</code> 操作。</p><p>于是，<a href="https://regexper.com#begin%7Cbegan%7Cbegun" target="_blank" rel="noopener"><code>begin|began|begun</code></a> 能够匹配 <code>begin</code> 或 <code>began</code> 或 <code>begun</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">str = <span class="string">'begin began begun begins beginn'</span></span><br><span class="line">pttn = <span class="string">r'begin|began|begun'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;begin&apos;, &apos;began&apos;, &apos;begun&apos;, &apos;begin&apos;, &apos;begin&apos;]</code></pre><p>在集合原子中（即，<code>[]</code> 内的原子）各个原子之间的关系，只有 “或” —— 相当于方括号中的每个原子之间都有一个被省略的 <code>|</code>。</p><p><strong>注意</strong>：方括号的 <code>|</code> 不被当作特殊符号，而是被当作 <code>|</code> 这个符号本身。在方括号中的圆括号，也被当作圆括号 <code>()</code> 本身，而无分组含义。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">str = <span class="string">'achroiocythaemia achroiocythemia a|e'</span></span><br><span class="line">pttn = <span class="string">r'[a|ae]'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'[a|e]'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'[ae]'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'[(ae)]'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">pttn = <span class="string">r'[a|ae|(ae)]'</span></span><br><span class="line">re.findall(pttn, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;a&apos;, &apos;a&apos;, &apos;e&apos;, &apos;a&apos;, &apos;a&apos;, &apos;e&apos;, &apos;a&apos;, &apos;a&apos;, &apos;|&apos;, &apos;e&apos;]</code></pre><h2 id="匹配并捕获"><a href="#匹配并捕获" class="headerlink" title="匹配并捕获"></a>匹配并捕获</h2><p>捕获（Capture），使用的是圆括号 <code>()</code>。使用圆括号得到的匹配的值被暂存成一个带有索引的列表，第一个是 <code>$1</code>，第二个是 <code>$2</code>…… 以此类推。随后，我们可以在替换的过程中使用 <code>$1</code> <code>$2</code> 中所保存的值。</p><p><strong>注意</strong>：在 Python 语言中调用 <code>re</code> 模块之后，在 <code>re.sub()</code> 中调用被匹配的值，用的索引方法是 <code>\1</code>、<code>\2</code>…… 以此类推。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">str = <span class="string">'The white dog wears a black hat.'</span></span><br><span class="line">pttn = <span class="string">r'The (white|black) dog wears a (white|black) hat.'</span></span><br><span class="line">re.findall(pttn, str)</span><br><span class="line"></span><br><span class="line">repl = <span class="string">r'The \2 dog wears a \1 hat.'</span></span><br><span class="line">re.sub(pttn, repl, str)</span><br><span class="line"></span><br><span class="line">repl = <span class="string">r'The \1 dog wears a \1 hat.'</span></span><br><span class="line">re.sub(pttn, repl, str)</span><br></pre></td></tr></table></figure><pre><code>[(&apos;white&apos;, &apos;black&apos;)]&apos;The black dog wears a white hat.&apos;&apos;The white dog wears a white hat.&apos;</code></pre><h2 id="非捕获匹配"><a href="#非捕获匹配" class="headerlink" title="非捕获匹配"></a>非捕获匹配</h2><p>有时，你并不想捕获圆括号中的内容，在那个地方你使用括号的目的只是分组，而非捕获，那么，你就在圆括号内最开头加上 <code>?:</code> —— <code>(?:...)</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">str = <span class="string">'The white dog wears a black hat.'</span></span><br><span class="line">pttn = <span class="string">r'The (?:white|black) dog wears a (white|black) hat.'</span></span><br><span class="line">re.findall(pttn, str)                   <span class="comment"># 只捕获了一处，也就是说只有一个值将来可以被引用</span></span><br><span class="line"></span><br><span class="line">repl = <span class="string">r'The \1 dog wears a \1 hat.'</span>    <span class="comment"># 之前的一处捕获，在替换时可被多次引用</span></span><br><span class="line">書評</span><br><span class="line">re.sub(pttn, repl, str)</span><br></pre></td></tr></table></figure><pre><code>[&apos;black&apos;]&apos;The black dog wears a black hat.&apos;</code></pre><p>在 Python 代码中使用正则表达式，匹配和捕获以及随后的替换，有更灵活的方式，因为可以对那些值直接编程。<code>re.sub()</code> 中，<code>repl</code> 参数甚至可以接收另外一个函数作为参数 —— 以后你肯定会自行认真阅读以下页面中的所有内容：</p><blockquote><p><a href="https://docs.python.org/3/library/re.html" target="_blank" rel="noopener">https://docs.python.org/3/library/re.html</a></p></blockquote><p>非捕获匹配，还有若干个操作符：</p><p> <code>(?=pattern)</code></p><blockquote><p>正向肯定预查（look ahead positive assert），在任何匹配规则的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，<a href="https://regexper.com#%60Windows(?=95%7C98%7CNT%7C2000)%60" target="_blank" rel="noopener"><code>Windows(?=95|98|NT|2000)</code></a><br>能匹配 <code>Windows2000</code> 中的 <code>Windows</code>，但不能匹配 <code>Windows3.1</code> 中的 <code>Windows</code>。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</p></blockquote><p><code>(?!pattern)</code></p><blockquote><p>正向否定预查（negative assert），在任何不匹配规则的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如<a href="https://regexper.com#Windows(?=95%7C98%7CNT%7C2000)" target="_blank" rel="noopener"><code>Windows(?!95|98|NT|2000)</code></a><br>能匹配 <code>Windows3.1</code> 中的 <code>Windows</code>，但不能匹配 <code>Windows2000</code> 中的 <code>Windows</code>。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</p></blockquote><p><code>(?&lt;=pattern)</code></p><blockquote><p>反向（look behind）肯定预查，与正向肯定预查类似，只是方向相反。例如，<a href="https://regexper.com#(?%3C=95%7C98%7CNT%7C2000)Windows" target="_blank" rel="noopener"><code>(?&lt;=95|98|NT|2000)Windows</code></a><br>能匹配 <code>2000Windows</code> 中的 <code>Windows</code>，但不能匹配 <code>3.1Windows</code> 中的 <code>Windows</code>。</p></blockquote><p> <code>(?&lt;!pattern)</code></p><blockquote><p>反向否定预查，与正向否定预查类似，只是方向相反。例如 <code>(?&lt;!95|98|NT|2000)Windows</code><br>能匹配 <code>3.1Windows</code> 中的 <code>Windows</code>，但不能匹配 <code>2000Windows</code> 中的 <code>Windows</code>。</p></blockquote><h2 id="控制标记"><a href="#控制标记" class="headerlink" title="控制标记"></a>控制标记</h2><p>有几个全局控制标记（Flag）需要了解，其中最常默认指定的有 <code>G</code> 和 <code>M</code>：</p><p><code>A</code>/<code>ASCII</code>，默认为 <code>False</code></p><blockquote><ul><li><code>\d</code>, <code>\D</code>, <code>\w</code>, <code>\W</code>, <code>\s</code>, <code>\S</code>, <code>\b</code>, 和 <code>\B</code> 等只限于 ASCII 字符</li><li>行内写法：<code>(?a)</code></li><li>Python re 模块中的常量：<code>re.A</code> <code>re.ASCII</code></li></ul></blockquote><p><code>I</code>/<code>IGNORECASE</code>，默认为 <code>False</code></p><blockquote><ul><li>忽略字母大小写</li><li>行内写法：<code>(?i)</code></li><li>Python re 模块中的常量：<code>re.I</code> <code>re.IGNORECASE</code></li></ul></blockquote><p><code>G</code>/<code>GLOBAL</code>，默认为 <code>True</code></p><blockquote><ul><li>找到第一个 match 之后不返回</li><li>行内写法：<code>(?g)</code></li><li>Python re 模块中这个标记不能更改，默认为 TRUE</li></ul></blockquote><p><code>L</code>/<code>LOCALE</code>，默认为 <code>False</code></p><blockquote><ul><li>由本地语言设置决定 <code>\d</code>, <code>\D</code>, <code>\w</code>, <code>\W</code>, <code>\s</code>, <code>\S</code>, <code>\b</code>, 和 <code>\B</code> 等等的内容</li><li>行内写法：<code>(?L)</code></li><li>Python re 模块中的常量：<code>re.L</code> <code>re.LOCALE</code></li></ul></blockquote><p><code>M</code>/<code>MULTILINE</code>，默认为 <code>True</code></p><blockquote><ul><li>使用本标志后，<code>^</code> 和 <code>$</code> 匹配行首和行尾时，会增加换行符之前和之后的位置。</li><li>行内写法：<code>(?m)</code></li><li>Python re 模块中的常量：<code>re.M</code> <code>re.MULTILINE</code></li></ul></blockquote><p><code>S</code>/<code>DOTALL</code>，默认为 <code>False</code></p><blockquote><ul><li>使 <code>.</code> 完全匹配任何字符，包括换行；没有这个标志，<code>.</code> 匹配除了 <code>n</code> <code>r</code> 之外的任何字符。</li><li>行内写法：<code>(?s)</code></li><li>Python re 模块中的常量：<code>re.S</code> <code>re.DOTALL</code></li></ul></blockquote><p><code>X</code>/<code>VERBOSE</code>，默认为 <code>False</code></p><blockquote><ul><li>当该标志被指定时，Pattern 中的的空白符会被忽略，除非该空白符在圆括号或方括号中，或在反斜杠 <code>\</code> 之后。这样做的结果是允许将注释写入 Pattern，这些注释会被 Regex 解析引擎忽略。注释用 <code>#</code> 号来标识，不过该符号不能在字符串或反斜杠之后。</li><li>行内写法：<code>(?x)</code></li><li>Python re 模块中的常量：<code>re.X</code> <code>re.VERBOSE</code></li></ul></blockquote><h2 id="几个最常用的-Regex"><a href="#几个最常用的-Regex" class="headerlink" title="几个最常用的 Regex"></a>几个最常用的 Regex</h2><p>以下是几个常用的 Regex<a href="#fn2" name="fn2b"><sup>[2]</sup></a>，值得保存：</p><ul><li><p>matching username</p><blockquote><p><a href="https://regexper.com#/%5E[a-z0-9_-]%7B3,16%7D$/" target="_blank" rel="noopener"><code>/^[a-z0-9_-]{3,16}$/</code></a></p></blockquote></li><li><p>matching password<a href="#fn3" name="fn3b"><sup>[3]</sup></a></p><blockquote><p><a href="https://regexper.com#/%5E[a-z0-9_-]%7B6,18%7D$/" target="_blank" rel="noopener"><code>/^[a-z0-9_-]{6,18}$/</code></a></p></blockquote></li><li><p>matching a HEX value</p><blockquote><p><a href="https://regexper.com#/%5E#?([a-f0-9]%7B6%7D%7C[a-f0-9]%7B3%7D)$/" target="_blank" rel="noopener"><code>/^#?([a-f0-9]{6}|[a-f0-9]{3})$/</code></a></p></blockquote></li><li><p>matching a slug</p><blockquote><p><a href="https://regexper.com#/%5E[a-z0-9-]+$/" target="_blank" rel="noopener"><code>/^[a-z0-9-]+$/</code></a></p></blockquote></li><li><p>matching email address</p><blockquote><p><a href="https://regexper.com#/%5E([a-z0-9_%5C.-]+)@([%5Cda-z%5C.-]+)%5C.([a-z%5C.]%7B2,6%7D)$/" target="_blank" rel="noopener"><code>/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/</code></a></p></blockquote></li><li><p>matching a URL</p><blockquote><p><a href="https://regexper.com#/%5E(https?:%5C/%5C/)?([%5Cda-z%5C.-]+)%5C.([a-z%5C.]%7B2,6%7D)([%5C/%5Cw%20%5C.-]*)*%5C/?$/" target="_blank" rel="noopener"><code>/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/</code></a></p></blockquote></li><li><p>matching an IP address</p><blockquote><p><a href="https://regexper.com/#%2F%5E%28%3F%3A%28%3F%3A25%5B0-5%5D%7C2%5B0-4%5D%5B0-9%5D%7C%5B01%5D%3F%5B0-9%5D%5B0-9%5D%3F%29%5C.%29%7B3%7D%28%3F%3A25%5B0-5%5D%7C2%5B0-4%5D%5B0-9%5D%7C%5B01%5D%3F%5B0-9%5D%5B0-9%5D%3F%29%24%2F" target="_blank" rel="noopener"><code>/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/</code></a></p></blockquote></li><li><p>matching a HTML tag</p><blockquote><p><a href="https://regexper.com/#%2F%5E<%28%5Ba-z%5D%2B%29%28%5B%5E<%5D%2B%29*%28%3F%3A>%28.*%29<%5C%2F%5C1>%7C%5Cs%2B%5C%2F>%29%24%2F" target="_blank" rel="noopener"><code>/^&lt;([a-z]+)([^&lt;]+)*(?:&gt;(.*)&lt;\/\1&gt;|\s+\/&gt;)$/</code></a></p></blockquote></li></ul><p>对了，告诉你一个小秘密：</p><blockquote><p>以上的正则表达式，点击都能连接到 <a href="https://regexper.com" target="_blank" rel="noopener">regexper.com</a>，在那里你能查看这些正则表达式的图形化示意图。另外，本文中，处于 markdown cell 的绝大多数正则表达式都有这样的连接…… 你可以重读的时候试试。</p></blockquote><p>写 Regex 最烧脑的地方在于 “使其全面” —— 要考虑到各种意外情况。</p><p>当然，除非必要，也不要在 “全面” 这事上面花太多时间 —— 给你看一个据说是 “最大程度上能够匹配所有 email 地址的 Regex” <a href="#fn4" name="fn4b"><sup>[4]</sup></a>，我都懒得测试的一个正则表达式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]</span><br><span class="line">)+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:</span><br><span class="line">\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(</span><br><span class="line">?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[</span><br><span class="line">\t]))*&quot;(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\0</span><br><span class="line">31]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\</span><br><span class="line">](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+</span><br><span class="line">(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:</span><br><span class="line">(?:\r\n)?[ \t])*))*|(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z</span><br><span class="line">|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)</span><br><span class="line">?[ \t])*)*\&lt;(?:(?:\r\n)?[ \t])*(?:@(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\</span><br><span class="line">r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[</span><br><span class="line"> \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)</span><br><span class="line">?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t]</span><br><span class="line">)*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[</span><br><span class="line"> \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*</span><br><span class="line">)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]</span><br><span class="line">)+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)</span><br><span class="line">*:(?:(?:\r\n)?[ \t])*)?(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+</span><br><span class="line">|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r</span><br><span class="line">\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:</span><br><span class="line">\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t</span><br><span class="line">]))*&quot;(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031</span><br><span class="line">]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](</span><br><span class="line">?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?</span><br><span class="line">:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?</span><br><span class="line">:\r\n)?[ \t])*))*\&gt;(?:(?:\r\n)?[ \t])*)|(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?</span><br><span class="line">:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?</span><br><span class="line">[ \t]))*&quot;(?:(?:\r\n)?[ \t])*)*:(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()&lt;&gt;@,;:\\&quot;.\[\]</span><br><span class="line">\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|</span><br><span class="line">\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;</span><br><span class="line">@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;</span><br><span class="line">(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t]</span><br><span class="line">)*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\</span><br><span class="line">&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?</span><br><span class="line">:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[</span><br><span class="line">\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-</span><br><span class="line">\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(</span><br><span class="line">?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])*)*\&lt;(?:(?:\r\n)?[ \t])*(?:@(?:[^()&lt;&gt;@,;</span><br><span class="line">:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([</span><br><span class="line">^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;</span><br><span class="line">.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\</span><br><span class="line">]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\</span><br><span class="line">[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\</span><br><span class="line">r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\]</span><br><span class="line">\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]</span><br><span class="line">|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \0</span><br><span class="line">00-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\</span><br><span class="line">.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,</span><br><span class="line">;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?</span><br><span class="line">:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*</span><br><span class="line">(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.</span><br><span class="line">\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[</span><br><span class="line">^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]</span><br><span class="line">]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\&gt;(?:(?:\r\n)?[ \t])*)(?:,\s*(</span><br><span class="line">?:(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\</span><br><span class="line">&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])*)(?:\.(?:(</span><br><span class="line">?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[</span><br><span class="line">\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t</span><br><span class="line">])*))*@(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t</span><br><span class="line">])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?</span><br><span class="line">:\.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|</span><br><span class="line">\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:</span><br><span class="line">[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\</span><br><span class="line">]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])*)*\&lt;(?:(?:\r\n)</span><br><span class="line">?[ \t])*(?:@(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;</span><br><span class="line">()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)</span><br><span class="line">?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;</span><br><span class="line">@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[</span><br><span class="line"> \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,</span><br><span class="line">;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t]</span><br><span class="line">)*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\</span><br><span class="line">&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?</span><br><span class="line">(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.</span><br><span class="line">\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:</span><br><span class="line">\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[</span><br><span class="line">&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|&quot;(?:[^\&quot;\r\\]|\\.|(?:(?:\r\n)?[ \t]))*&quot;(?:(?:\r\n)?[ \t])</span><br><span class="line">*))*@(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])</span><br><span class="line">+|\Z|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\</span><br><span class="line">.(?:(?:\r\n)?[ \t])*(?:[^()&lt;&gt;@,;:\\&quot;.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z</span><br><span class="line">|(?=[\[&quot;()&lt;&gt;@,;:\\&quot;.\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\&gt;(?:(</span><br><span class="line">?:\r\n)?[ \t])*))*)?;\s*)</span><br></pre></td></tr></table></figure><h2 id="趣事一则"><a href="#趣事一则" class="headerlink" title="趣事一则"></a>趣事一则</h2><p><a href="https://en.wikipedia.org/wiki/ELIZA" target="_blank" rel="noopener">ELIZA</a> 是人类史上第一个 “聊天机器人” 程序，上个世纪六十年代，1966 年实现的。核心就是使用正则表达式匹配对方语句中的关键词汇，再经过替换，形成看似有意义的 “回应” —— 事实上，ELIZA 完全不知道自己在说什么……</p><p>几年后，就是七十年代初，1972 年，另外一个聊天机器人 <a href="https://en.wikipedia.org/wiki/PARRY" target="_blank" rel="noopener">Parry</a> <a href="#fn5" name="fn5b"><sup>[5]</sup></a>被写了出来…… 随后第二年，这两个聊天机器人在 ARPANET “碰面” 好好地聊了一下<a href="#fn6" name="fn6b"><sup>[6]</sup></a>：</p><blockquote><p>ELIZA: Good Evening. Tell me your problems. Please terminate input with a period or a question mark.</p><p>PARRY: People get on my nerves sometimes.</p><p>ELIZA: I am not sure I understand you fully.</p><p>PARRY: You should pay more attention.</p><p>ELIZA: Suppose you should pay more attention.</p><p>PARRY: You’re entitled to your own opinion.</p><p>ELIZA: What makes you think I am entitled to my own opinion?</p><p>PARRY: It bothers me just to be around people in general.</p><p>ELIZA: Please go on.</p><p>PARRY: I went to the track at Bay Meadows a while back.</p><p>ELIZA: What does that suggest to you?</p><p>PARRY: I went to the races.</p><p>……</p></blockquote><p>以下是后人用 Python 重新实现的 ELIZA 的程序代码，你可以直接执行它，尝试一下与 ELIZA 聊聊天：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># %load https://raw.githubusercontent.com/jezhiggins/eliza.py/master/eliza.py</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#  eliza.py</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  a cheezy little Eliza knock-off by Joe Strout</span></span><br><span class="line"><span class="comment">#  with some updates by Jeff Epler</span></span><br><span class="line"><span class="comment">#  hacked into a module and updated by Jez Higgins</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eliza</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.keys = list(map(<span class="keyword">lambda</span> x:re.compile(x[<span class="number">0</span>], re.IGNORECASE),gPats))</span><br><span class="line">    self.values = list(map(<span class="keyword">lambda</span> x:x[<span class="number">1</span>],gPats))</span><br><span class="line"></span><br><span class="line">  <span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># translate: take a string, replace any words found in dict.keys()</span></span><br><span class="line">  <span class="comment">#  with the corresponding dict.values()</span></span><br><span class="line">  <span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">translate</span><span class="params">(self,str,dict)</span>:</span></span><br><span class="line">    words = str.lower().split()</span><br><span class="line">    keys = dict.keys();</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(words)):</span><br><span class="line">      <span class="keyword">if</span> words[i] <span class="keyword">in</span> keys:</span><br><span class="line">        words[i] = dict[words[i]]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">' '</span>.join(words)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment">#  respond: take a string, a set of regexps, and a corresponding</span></span><br><span class="line">  <span class="comment">#    set of response lists; find a match, and return a randomly</span></span><br><span class="line">  <span class="comment">#    chosen response from the corresponding list.</span></span><br><span class="line">  <span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">respond</span><span class="params">(self,str)</span>:</span></span><br><span class="line">    <span class="comment"># find a match among keys</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(self.keys)):</span><br><span class="line">      match = self.keys[i].match(str)</span><br><span class="line">      <span class="keyword">if</span> match:</span><br><span class="line">        <span class="comment"># found a match ... stuff with corresponding value</span></span><br><span class="line">        <span class="comment"># chosen randomly from among the available options</span></span><br><span class="line">        resp = random.choice(self.values[i])</span><br><span class="line">        <span class="comment"># we've got a response... stuff in reflected text where indicated</span></span><br><span class="line">        pos = resp.find(<span class="string">'%'</span>)</span><br><span class="line">        <span class="keyword">while</span> pos &gt; <span class="number">-1</span>:</span><br><span class="line">          num = int(resp[pos+<span class="number">1</span>:pos+<span class="number">2</span>])</span><br><span class="line">          resp = resp[:pos] + \</span><br><span class="line">            self.translate(match.group(num),gReflections) + \</span><br><span class="line">            resp[pos+<span class="number">2</span>:]</span><br><span class="line">          pos = resp.find(<span class="string">'%'</span>)</span><br><span class="line">        <span class="comment"># fix munged punctuation at the end</span></span><br><span class="line">        <span class="keyword">if</span> resp[<span class="number">-2</span>:] == <span class="string">'?.'</span>: resp = resp[:<span class="number">-2</span>] + <span class="string">'.'</span></span><br><span class="line">        <span class="keyword">if</span> resp[<span class="number">-2</span>:] == <span class="string">'??'</span>: resp = resp[:<span class="number">-2</span>] + <span class="string">'?'</span></span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># gReflections, a translation table used to convert things you say</span></span><br><span class="line"><span class="comment">#    into things the computer says back, e.g. "I am" --&gt; "you are"</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line">gReflections = &#123;</span><br><span class="line">  <span class="string">"am"</span>   : <span class="string">"are"</span>,</span><br><span class="line">  <span class="string">"was"</span>  : <span class="string">"were"</span>,</span><br><span class="line">  <span class="string">"i"</span>    : <span class="string">"you"</span>,</span><br><span class="line">  <span class="string">"i'd"</span>  : <span class="string">"you would"</span>,</span><br><span class="line">  <span class="string">"i've"</span>  : <span class="string">"you have"</span>,</span><br><span class="line">  <span class="string">"i'll"</span>  : <span class="string">"you will"</span>,</span><br><span class="line">  <span class="string">"my"</span>  : <span class="string">"your"</span>,</span><br><span class="line">  <span class="string">"are"</span>  : <span class="string">"am"</span>,</span><br><span class="line">  <span class="string">"you've"</span>: <span class="string">"I have"</span>,</span><br><span class="line">  <span class="string">"you'll"</span>: <span class="string">"I will"</span>,</span><br><span class="line">  <span class="string">"your"</span>  : <span class="string">"my"</span>,</span><br><span class="line">  <span class="string">"yours"</span>  : <span class="string">"mine"</span>,</span><br><span class="line">  <span class="string">"you"</span>  : <span class="string">"me"</span>,</span><br><span class="line">  <span class="string">"me"</span>  : <span class="string">"you"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># gPats, the main response table.  Each element of the list is a</span></span><br><span class="line"><span class="comment">#  two-element list; the first is a regexp, and the second is a</span></span><br><span class="line"><span class="comment">#  list of possible responses, with group-macros labelled as</span></span><br><span class="line"><span class="comment">#  %1, %2, etc.</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line">gPats = [</span><br><span class="line">  [<span class="string">r'I need (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Why do you need %1?"</span>,</span><br><span class="line">    <span class="string">"Would it really help you to get %1?"</span>,</span><br><span class="line">    <span class="string">"Are you sure you need %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Why don\'?t you ([^\?]*)\??'</span>,</span><br><span class="line">  [  <span class="string">"Do you really think I don't %1?"</span>,</span><br><span class="line">    <span class="string">"Perhaps eventually I will %1."</span>,</span><br><span class="line">    <span class="string">"Do you really want me to %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Why can\'?t I ([^\?]*)\??'</span>,</span><br><span class="line">  [  <span class="string">"Do you think you should be able to %1?"</span>,</span><br><span class="line">    <span class="string">"If you could %1, what would you do?"</span>,</span><br><span class="line">    <span class="string">"I don't know -- why can't you %1?"</span>,</span><br><span class="line">    <span class="string">"Have you really tried?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I can\'?t (.*)'</span>,</span><br><span class="line">  [  <span class="string">"How do you know you can't %1?"</span>,</span><br><span class="line">    <span class="string">"Perhaps you could %1 if you tried."</span>,</span><br><span class="line">    <span class="string">"What would it take for you to %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I am (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Did you come to me because you are %1?"</span>,</span><br><span class="line">    <span class="string">"How long have you been %1?"</span>,</span><br><span class="line">    <span class="string">"How do you feel about being %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I\'?m (.*)'</span>,</span><br><span class="line">  [  <span class="string">"How does being %1 make you feel?"</span>,</span><br><span class="line">    <span class="string">"Do you enjoy being %1?"</span>,</span><br><span class="line">    <span class="string">"Why do you tell me you're %1?"</span>,</span><br><span class="line">    <span class="string">"Why do you think you're %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Are you ([^\?]*)\??'</span>,</span><br><span class="line">  [  <span class="string">"Why does it matter whether I am %1?"</span>,</span><br><span class="line">    <span class="string">"Would you prefer it if I were not %1?"</span>,</span><br><span class="line">    <span class="string">"Perhaps you believe I am %1."</span>,</span><br><span class="line">    <span class="string">"I may be %1 -- what do you think?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'What (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Why do you ask?"</span>,</span><br><span class="line">    <span class="string">"How would an answer to that help you?"</span>,</span><br><span class="line">    <span class="string">"What do you think?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'How (.*)'</span>,</span><br><span class="line">  [  <span class="string">"How do you suppose?"</span>,</span><br><span class="line">    <span class="string">"Perhaps you can answer your own question."</span>,</span><br><span class="line">    <span class="string">"What is it you're really asking?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Because (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Is that the real reason?"</span>,</span><br><span class="line">    <span class="string">"What other reasons come to mind?"</span>,</span><br><span class="line">    <span class="string">"Does that reason apply to anything else?"</span>,</span><br><span class="line">    <span class="string">"If %1, what else must be true?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'(.*) sorry (.*)'</span>,</span><br><span class="line">  [  <span class="string">"There are many times when no apology is needed."</span>,</span><br><span class="line">    <span class="string">"What feelings do you have when you apologize?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Hello(.*)'</span>,</span><br><span class="line">  [  <span class="string">"Hello... I'm glad you could drop by today."</span>,</span><br><span class="line">    <span class="string">"Hi there... how are you today?"</span>,</span><br><span class="line">    <span class="string">"Hello, how are you feeling today?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I think (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Do you doubt %1?"</span>,</span><br><span class="line">    <span class="string">"Do you really think so?"</span>,</span><br><span class="line">    <span class="string">"But you're not sure %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'(.*) friend (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Tell me more about your friends."</span>,</span><br><span class="line">    <span class="string">"When you think of a friend, what comes to mind?"</span>,</span><br><span class="line">    <span class="string">"Why don't you tell me about a childhood friend?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Yes'</span>,</span><br><span class="line">  [  <span class="string">"You seem quite sure."</span>,</span><br><span class="line">    <span class="string">"OK, but can you elaborate a bit?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'(.*) computer(.*)'</span>,</span><br><span class="line">  [  <span class="string">"Are you really talking about me?"</span>,</span><br><span class="line">    <span class="string">"Does it seem strange to talk to a computer?"</span>,</span><br><span class="line">    <span class="string">"How do computers make you feel?"</span>,</span><br><span class="line">    <span class="string">"Do you feel threatened by computers?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Is it (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Do you think it is %1?"</span>,</span><br><span class="line">    <span class="string">"Perhaps it's %1 -- what do you think?"</span>,</span><br><span class="line">    <span class="string">"If it were %1, what would you do?"</span>,</span><br><span class="line">    <span class="string">"It could well be that %1."</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'It is (.*)'</span>,</span><br><span class="line">  [  <span class="string">"You seem very certain."</span>,</span><br><span class="line">    <span class="string">"If I told you that it probably isn't %1, what would you feel?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Can you ([^\?]*)\??'</span>,</span><br><span class="line">  [  <span class="string">"What makes you think I can't %1?"</span>,</span><br><span class="line">    <span class="string">"If I could %1, then what?"</span>,</span><br><span class="line">    <span class="string">"Why do you ask if I can %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Can I ([^\?]*)\??'</span>,</span><br><span class="line">  [  <span class="string">"Perhaps you don't want to %1."</span>,</span><br><span class="line">    <span class="string">"Do you want to be able to %1?"</span>,</span><br><span class="line">    <span class="string">"If you could %1, would you?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'You are (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Why do you think I am %1?"</span>,</span><br><span class="line">    <span class="string">"Does it please you to think that I'm %1?"</span>,</span><br><span class="line">    <span class="string">"Perhaps you would like me to be %1."</span>,</span><br><span class="line">    <span class="string">"Perhaps you're really talking about yourself?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'You\'?re (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Why do you say I am %1?"</span>,</span><br><span class="line">    <span class="string">"Why do you think I am %1?"</span>,</span><br><span class="line">    <span class="string">"Are we talking about you, or me?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I don\'?t (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Don't you really %1?"</span>,</span><br><span class="line">    <span class="string">"Why don't you %1?"</span>,</span><br><span class="line">    <span class="string">"Do you want to %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I feel (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Good, tell me more about these feelings."</span>,</span><br><span class="line">    <span class="string">"Do you often feel %1?"</span>,</span><br><span class="line">    <span class="string">"When do you usually feel %1?"</span>,</span><br><span class="line">    <span class="string">"When you feel %1, what do you do?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I have (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Why do you tell me that you've %1?"</span>,</span><br><span class="line">    <span class="string">"Have you really %1?"</span>,</span><br><span class="line">    <span class="string">"Now that you have %1, what will you do next?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I would (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Could you explain why you would %1?"</span>,</span><br><span class="line">    <span class="string">"Why would you %1?"</span>,</span><br><span class="line">    <span class="string">"Who else knows that you would %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Is there (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Do you think there is %1?"</span>,</span><br><span class="line">    <span class="string">"It's likely that there is %1."</span>,</span><br><span class="line">    <span class="string">"Would you like there to be %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'My (.*)'</span>,</span><br><span class="line">  [  <span class="string">"I see, your %1."</span>,</span><br><span class="line">    <span class="string">"Why do you say that your %1?"</span>,</span><br><span class="line">    <span class="string">"When your %1, how do you feel?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'You (.*)'</span>,</span><br><span class="line">  [  <span class="string">"We should be discussing you, not me."</span>,</span><br><span class="line">    <span class="string">"Why do you say that about me?"</span>,</span><br><span class="line">    <span class="string">"Why do you care whether I %1?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'Why (.*)'</span>,</span><br><span class="line">  [  <span class="string">"Why don't you tell me the reason why %1?"</span>,</span><br><span class="line">    <span class="string">"Why do you think %1?"</span> ]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'I want (.*)'</span>,</span><br><span class="line">  [  <span class="string">"What would it mean to you if you got %1?"</span>,</span><br><span class="line">    <span class="string">"Why do you want %1?"</span>,</span><br><span class="line">    <span class="string">"What would you do if you got %1?"</span>,</span><br><span class="line">    <span class="string">"If you got %1, then what would you do?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'(.*) mother(.*)'</span>,</span><br><span class="line">  [  <span class="string">"Tell me more about your mother."</span>,</span><br><span class="line">    <span class="string">"What was your relationship with your mother like?"</span>,</span><br><span class="line">    <span class="string">"How do you feel about your mother?"</span>,</span><br><span class="line">    <span class="string">"How does this relate to your feelings today?"</span>,</span><br><span class="line">    <span class="string">"Good family relations are important."</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'(.*) father(.*)'</span>,</span><br><span class="line">  [  <span class="string">"Tell me more about your father."</span>,</span><br><span class="line">    <span class="string">"How did your father make you feel?"</span>,</span><br><span class="line">    <span class="string">"How do you feel about your father?"</span>,</span><br><span class="line">    <span class="string">"Does your relationship with your father relate to your feelings today?"</span>,</span><br><span class="line">    <span class="string">"Do you have trouble showing affection with your family?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'(.*) child(.*)'</span>,</span><br><span class="line">  [  <span class="string">"Did you have close friends as a child?"</span>,</span><br><span class="line">    <span class="string">"What is your favorite childhood memory?"</span>,</span><br><span class="line">    <span class="string">"Do you remember any dreams or nightmares from childhood?"</span>,</span><br><span class="line">    <span class="string">"Did the other children sometimes tease you?"</span>,</span><br><span class="line">    <span class="string">"How do you think your childhood experiences relate to your feelings today?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'(.*)\?'</span>,</span><br><span class="line">  [  <span class="string">"Why do you ask that?"</span>,</span><br><span class="line">    <span class="string">"Please consider whether you can answer your own question."</span>,</span><br><span class="line">    <span class="string">"Perhaps the answer lies within yourself?"</span>,</span><br><span class="line">    <span class="string">"Why don't you tell me?"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'quit'</span>,</span><br><span class="line">  [  <span class="string">"Thank you for talking with me."</span>,</span><br><span class="line">    <span class="string">"Good-bye."</span>,</span><br><span class="line">    <span class="string">"Thank you, that will be $150.  Have a good day!"</span>]],</span><br><span class="line"></span><br><span class="line">  [<span class="string">r'(.*)'</span>,</span><br><span class="line">  [  <span class="string">"Please tell me more."</span>,</span><br><span class="line">    <span class="string">"Let's change focus a bit... Tell me about your family."</span>,</span><br><span class="line">    <span class="string">"Can you elaborate on that?"</span>,</span><br><span class="line">    <span class="string">"Why do you say that %1?"</span>,</span><br><span class="line">    <span class="string">"I see."</span>,</span><br><span class="line">    <span class="string">"Very interesting."</span>,</span><br><span class="line">    <span class="string">"%1."</span>,</span><br><span class="line">    <span class="string">"I see.  And what does that tell you?"</span>,</span><br><span class="line">    <span class="string">"How does that make you feel?"</span>,</span><br><span class="line">    <span class="string">"How do you feel when you say that?"</span>]]</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#  command_interface</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">command_interface</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'Therapist\n---------'</span>)</span><br><span class="line">  print(<span class="string">'Talk to the program by typing in plain English, using normal upper-'</span>)</span><br><span class="line">  print(<span class="string">'and lower-case letters and punctuation.  Enter "quit" when done.'</span>)</span><br><span class="line">  print(<span class="string">'='</span>*<span class="number">72</span>)</span><br><span class="line">  print(<span class="string">'Hello.  How are you feeling today?'</span>)</span><br><span class="line"></span><br><span class="line">  s = <span class="string">''</span></span><br><span class="line">  therapist = eliza();</span><br><span class="line">  <span class="keyword">while</span> s != <span class="string">'quit'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      s = input(<span class="string">'&gt; '</span>)</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">      s = <span class="string">'quit'</span></span><br><span class="line">    print(s)</span><br><span class="line">    <span class="keyword">while</span> s[<span class="number">-1</span>] <span class="keyword">in</span> <span class="string">'!.'</span>:</span><br><span class="line">      s = s[:<span class="number">-1</span>]</span><br><span class="line">    print(therapist.respond(s))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">  command_interface()</span><br></pre></td></tr></table></figure><pre><code>Therapist---------Talk to the program by typing in plain English, using normal upper-and lower-case letters and punctuation.  Enter &quot;quit&quot; when done.========================================================================Hello.  How are you feeling today?</code></pre><hr><p><strong>脚注</strong></p><p><a name="fn1">[1]</a>：释义摘自苹果电脑上系统内建的《牛津英汉双解辞典》</p><p><a href="#fn1b"><small>↑Back to Content↑</small></a></p><p><a name="fn2">[2]</a>：<a href="https://bit.ly/2tz8v9n" target="_blank" rel="noopener">8 Regular Expressions You Should Know</a> by Vasili</p><p><a href="#fn2b"><small>↑Back to Content↑</small></a></p><p><a name="fn3">[3]</a>：关于校验密码强度的正则表达式，往往需要设置更为复杂的规则，Stackoverflow 上的一则答复中有很好的示例：<a href="https://stackoverflow.com/a/21456918" target="_blank" rel="noopener">https://stackoverflow.com/a/21456918</a></p><p><a href="#fn3b"><small>↑Back to Content↑</small></a></p><p><a name="fn4">[4]</a>：<a href="http://www.ex-parrot.com/pdw/Mail-RFC822-Address.html" target="_blank" rel="noopener">http://www.ex-parrot.com/pdw/Mail-RFC822-Address.html</a></p><p><a href="#fn4b"><small>↑Back to Content↑</small></a></p><p><a name="fn5">[5]</a>：Parry 的源代码（用 Lisp 写的）在这里：<a href="http://www.cs.cmu.edu/afs/cs/project/ai-repository/ai/areas/classics/parry/" target="_blank" rel="noopener">http://www.cs.cmu.edu/afs/cs/project/ai-repository/ai/areas/classics/parry/</a></p><p><a href="#fn5b"><small>↑Back to Content↑</small></a></p><p><a name="fn6">[6]</a>：ELIZA 和 Parry 的完整聊天记录在这里：<a href="https://tools.ietf.org/html/rfc439" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc439</a></p><p><a href="#fn6b"><small>↑Back to Content↑</small></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>evomics 课程</title>
      <link href="/2019/09/12/SVDQUARTETS%20AND%20ASTRAL%20ACTIVITY/"/>
      <url>/2019/09/12/SVDQUARTETS%20AND%20ASTRAL%20ACTIVITY/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="http://evomics.org/learning/population-and-speciation-genomics/2018-population-and-speciation-genomics/svdquartets-astral-activity/" target="_blank" rel="noopener">http://evomics.org/learning/population-and-speciation-genomics/2018-population-and-speciation-genomics/svdquartets-astral-activity/</a></p></blockquote><p>下载实验数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cd /Users/sunhaoyun/Downloads/sample_data</span><br><span class="line">wget phylosolutions.com/tutorials/wpsg2018/svdquartets_tutorial.zip</span><br><span class="line">cd svdquartets_tutorial</span><br></pre></td></tr></table></figure><p>从Liu和Edwards（2009）使用的一个例子开始，注意由于“不完全谱系分选”现象导致个别基因座的基因树与物种树发生冲突</p><p>首先用交互模式，对Liu的数据进行重复，其中-L参数为打开一个log文件储存所有输出结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paup anomaly_zone.nex -L anomaly.log</span><br></pre></td></tr></table></figure><p>从串联最大似然分析开始，使用logdet距离进行nj分析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">paup&gt; dset distance=logdet;</span><br><span class="line">paup&gt; nj;</span><br><span class="line">paup&gt; automodel;</span><br></pre></td></tr></table></figure><p>automodel将评估一组56个模型，选择最小化AIC的模型。 完成后，模型参数将设置为其最大似然估计值，我们可以将其作为最大似然搜索的起点，随后查看树</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">paup&gt; set criterion=likelihood;</span><br><span class="line">paup&gt; hsearch;</span><br><span class="line">paup&gt; describe/plot=p;</span><br></pre></td></tr></table></figure><p>记住这棵树的拓扑关系所暗示的分类群之间的关系，然后对对相同的数据进行svdquartets分析</p><p>可选参数：</p><p>quartets exhaustively (“evalquartets=all”)</p><p>sample quartets randomly (“evalquartets=random nquartets=n”)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paup&gt; svdq evalq=all bootstrap;</span><br></pre></td></tr></table></figure><p>该树从理论是与所有5个推断的四重关系兼容，但串联分析的ML方法估计树不正确。 记下两个内部节点的引导比例，以便稍后讨论。</p><p>博主写了小脚本可以用以快速生成命令，其中！开头代表对外部命令行执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">paup&gt; !cat  astral_prep.py</span><br><span class="line">paup&gt; !python astral_prep.py &gt; run_astral.nex</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> evolution </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>坑爹的Mac 和离家出走</title>
      <link href="/2019/09/12/Record/"/>
      <url>/2019/09/12/Record/</url>
      
        <content type="html"><![CDATA[<p>到新的学校之后发现，shadowsocks代理无法使用了，主要现象为国内网站可以正常访问，国外网站访问不了，打开之前学校的VPN才可以访问内外网，但网速又受到了限制。因为手机上可以正常访问ins youtube，怀疑电脑DNS解析有问题，然后修改偏好设置里的DNS发现没什么卵用。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前网络</span><br><span class="line">networksetup -listallnetworkservices</span><br><span class="line"># 修改WIFI</span><br><span class="line">networksetup -setdnsservers Wi-Fi 114.114.114.114</span><br><span class="line"># 确认一下</span><br><span class="line">networksetup -getdnsservers Wi-Fi</span><br><span class="line"># 刷新DNS</span><br><span class="line">dscacheutil -flushcache</span><br></pre></td></tr></table></figure><p>成功解决</p><p>但是在修改完成后，下楼取了个快递，回来发现依然不能访问外网</p><p>发现极其不稳定</p><p>打开shadowsocks的全局模式 </p><p>成功解决，暂时较为稳定</p><p>下次研究一下如何代理打开terminal，因为现在两个学校的服务器都只能内网访问，资料传输及其不方便</p><p><strong><em>同时还发现Mac的一个问题，在打开MotionPro的情况下，由于软件兼容性问题会造成闪屏，类似触电的赶脚，哎</em></strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HMM 隐式马尔可夫模型</title>
      <link href="/2019/08/29/HMM_example/"/>
      <url>/2019/08/29/HMM_example/</url>
      
        <content type="html"><![CDATA[<h2 id="Hidden-Markov-Model-隐含马尔可夫模型和-Viterbi-algorithm-维特比算法示例"><a href="#Hidden-Markov-Model-隐含马尔可夫模型和-Viterbi-algorithm-维特比算法示例" class="headerlink" title="Hidden Markov Model 隐含马尔可夫模型和 Viterbi algorithm 维特比算法示例"></a>Hidden Markov Model 隐含马尔可夫模型和 Viterbi algorithm 维特比算法示例</h2><p>基本概念：首先它得是一个统计模型，通过已有的样本来预测马尔可夫过程中的隐含参数。</p><p>可见状态链：观测得到的样本组成的数据集</p><p>隐含状态链：样本背后的隐含的数据集</p><p>转换概率 transition probability：可随意设定转换概率，根据不同的转换概率会得到不同的HMM模型</p><p>输出概率 emission probability：从隐含状态转换为可见状态时的概率，也可自由设定</p><a id="more"></a> <p>提到马尔可夫链，基本上指的都是隐含状态链，因为在隐含状态链之间存在转换概率。我们在求马尔可夫过程的时候，可以分为以下情况：</p><p>​                知道<strong><em>隐含状态数量</em></strong>，知道<strong><em>转换概率</em></strong>，根据<strong><em>可见状态链</em></strong>，求<strong><em>隐含状态链</em></strong>。这是最简单的解码问题，有两种解决方法，两种都对，但结果的意义不一样。一种解法，通过最大似然直接对链的整体找到最可能的解，另一种通过对每一个单次事件概率。两种的差异个人觉得在于看中整体与局部。</p><p>​                知道<strong><em>隐含状态数量</em></strong>，知道<strong><em>转换概率</em></strong>，根据<strong><em>可见状态链</em></strong>，求<strong><em>发生可见状态链的概率</em></strong>。这种问题是用来检测数据是否真的与模型吻合。</p><p>​                知道<strong><em>隐含状态数量</em></strong>，不知道<strong><em>转换概率</em></strong>，根据<strong><em>可见状态链</em></strong>，求<strong><em>转换概率</em></strong>。这种为最常见的情况。此处用到Viterbi algorithm 算法。直接以下面的晴雨天为例子</p><blockquote><p> 说两句废话，答主认为呢，要了解一个算法，要做到以下两点：会其意，知其形。答主回答的，其实主要是第一点。但是这一点呢，恰恰是最重要，而且很多书上不会讲的。正如你在追一个姑娘，姑娘对你说“你什么都没做错！”你要是只看姑娘的表达形式呢，认为自己什么都没做错，显然就理解错了。你要理会姑娘的意思，“你赶紧给我道歉！”这样当你看到对应的表达形式呢，赶紧认错，跪地求饶就对了。数学也是一样，你要是不理解意思，光看公式，往往一头雾水。不过呢，数学的表达顶多也就是晦涩了点，姑娘的表达呢，有的时候就完全和本意相反。所以答主一直认为理解姑娘比理解数学难多了。</p></blockquote><p>HMM（隐马尔可夫模型）是用来描述隐含未知参数的统计模型，举一个经典的例子：一个东京的朋友每天根据天气{下雨，天晴}决定当天的活动{公园散步,购物,清理房间}中的一种，我每天只能在twitter上看到她发的推“啊，我前天公园散步、昨天购物、今天清理房间了！”，那么我可以根据她发的推特推断东京这三天的天气。在这个例子里，显状态是活动，隐状态是天气</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Filename: viterbi.py</span></span><br><span class="line"><span class="comment"># Author：hankcs</span></span><br><span class="line"><span class="comment"># Date: 2014-05-13 下午8:51</span></span><br><span class="line"></span><br><span class="line">states = (<span class="string">'Rainy'</span>, <span class="string">'Sunny'</span>)</span><br><span class="line"></span><br><span class="line">observations = (<span class="string">'walk'</span>, <span class="string">'shop'</span>, <span class="string">'clean'</span>)</span><br><span class="line"></span><br><span class="line">start_probability = &#123;<span class="string">'Rainy'</span>: <span class="number">0.6</span>, <span class="string">'Sunny'</span>: <span class="number">0.4</span>&#125;</span><br><span class="line"></span><br><span class="line">transition_probability = &#123;</span><br><span class="line">    <span class="string">'Rainy'</span>: &#123;<span class="string">'Rainy'</span>: <span class="number">0.7</span>, <span class="string">'Sunny'</span>: <span class="number">0.3</span>&#125;,</span><br><span class="line">    <span class="string">'Sunny'</span>: &#123;<span class="string">'Rainy'</span>: <span class="number">0.4</span>, <span class="string">'Sunny'</span>: <span class="number">0.6</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">emission_probability = &#123;</span><br><span class="line">    <span class="string">'Rainy'</span>: &#123;<span class="string">'walk'</span>: <span class="number">0.1</span>, <span class="string">'shop'</span>: <span class="number">0.4</span>, <span class="string">'clean'</span>: <span class="number">0.5</span>&#125;,</span><br><span class="line">    <span class="string">'Sunny'</span>: &#123;<span class="string">'walk'</span>: <span class="number">0.6</span>, <span class="string">'shop'</span>: <span class="number">0.3</span>, <span class="string">'clean'</span>: <span class="number">0.1</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印路径概率表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_dptable</span><span class="params">(V)</span>:</span></span><br><span class="line">    print(<span class="string">"    "</span>),</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(V)):</span><br><span class="line">        print(<span class="string">"%7d"</span> % i),</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> V[<span class="number">0</span>].keys():</span><br><span class="line">        print(<span class="string">"%.5s: "</span> % y),</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(len(V)):</span><br><span class="line">            print(<span class="string">"%.7s"</span> % (<span class="string">"%f"</span> % V[t][y])),</span><br><span class="line">        <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(obs, states, start_p, trans_p, emit_p)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    # 任何一个HMM都可以通过下列五元组来描述</span></span><br><span class="line"><span class="string">    :param obs:观测序列</span></span><br><span class="line"><span class="string">    :param states:隐状态</span></span><br><span class="line"><span class="string">    :param start_p:初始概率（隐状态）</span></span><br><span class="line"><span class="string">    :param trans_p:转移概率（隐状态）</span></span><br><span class="line"><span class="string">    :param emit_p: 发射概率 （隐状态表现为显状态的概率）</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 路径概率表 V[时间][隐状态] = 概率</span></span><br><span class="line">    V = [&#123;&#125;]</span><br><span class="line">    <span class="comment"># 一个中间变量，代表当前状态是哪个隐状态</span></span><br><span class="line">    path = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化初始状态 (t == 0)</span></span><br><span class="line">    print(<span class="string">'Day 1(walk): '</span>)</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">        V[<span class="number">0</span>][y] = start_p[y] * emit_p[y][obs[<span class="number">0</span>]]</span><br><span class="line">        path[y] = [y]</span><br><span class="line">        <span class="keyword">print</span> y, V[<span class="number">0</span>][y], <span class="string">'='</span>, start_p[y], <span class="string">'*'</span>, emit_p[y][obs[<span class="number">0</span>]]</span><br><span class="line">    print(<span class="string">'_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _'</span>)</span><br><span class="line">    <span class="keyword">print</span><span class="string">'V: '</span>, V</span><br><span class="line">    print(<span class="string">'__________________________________________'</span>)</span><br><span class="line">    <span class="comment"># 对 t &gt; 0 跑一遍维特比算法</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, len(obs)):</span><br><span class="line">        V.append(&#123;&#125;)</span><br><span class="line">        newpath = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Day'</span>, t+<span class="number">1</span>, <span class="string">'('</span>+obs[t]+<span class="string">')'</span></span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">            <span class="comment"># 概率 隐状态 =    前状态是y0的概率 * y0转移到y的概率 * y表现为当前状态的概率</span></span><br><span class="line">            <span class="comment"># (prob, state) = max([(V[t - 1][y0] * trans_p[y0][y] * emit_p[y][obs[t]], y0) for y0 in states])</span></span><br><span class="line">            tmpList = []</span><br><span class="line">            <span class="keyword">print</span></span><br><span class="line">            <span class="keyword">for</span> y0 <span class="keyword">in</span> states:</span><br><span class="line">                tmpList.append((V[t - <span class="number">1</span>][y0] * trans_p[y0][y] * \</span><br><span class="line">                emit_p[y][obs[t]], y0))</span><br><span class="line"></span><br><span class="line">                <span class="keyword">print</span> <span class="string">'當天'</span>+y+<span class="string">': '</span>, <span class="string">"%.7s"</span> % (V[t - <span class="number">1</span>][y0] * trans_p[y0][y] * \</span><br><span class="line">emit_p[y][obs[t]]),</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'='</span>,</span><br><span class="line">                <span class="keyword">print</span> V[t - <span class="number">1</span>][y0], <span class="string">'(前一天 '</span>+y0+<span class="string">')'</span>, <span class="string">'*'</span>,</span><br><span class="line">                <span class="keyword">print</span> trans_p[y0][y], <span class="string">'('</span>+y0+<span class="string">' to '</span>+y+<span class="string">')'</span>, <span class="string">'*'</span>,</span><br><span class="line">                <span class="keyword">print</span> emit_p[y][obs[t]], <span class="string">'('</span>+y, obs[t]+<span class="string">')'</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">'當天'</span>+y+<span class="string">'  最大的是: '</span>, max(tmpList)[<span class="number">0</span>]</span><br><span class="line">            (prob, state) = max(tmpList)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 记录最大概率</span></span><br><span class="line">            V[t][y] = prob</span><br><span class="line">            <span class="comment"># 记录路径</span></span><br><span class="line">            newpath[y] = path[state] + [y]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 不需要保留旧路径</span></span><br><span class="line">        path = newpath</span><br><span class="line">        print(<span class="string">'__________________________________________'</span>)</span><br><span class="line"></span><br><span class="line">    print_dptable(V)</span><br><span class="line">    (prob, state) = max([(V[len(obs) - <span class="number">1</span>][y], y) <span class="keyword">for</span> y <span class="keyword">in</span> states])</span><br><span class="line">    <span class="keyword">return</span> (prob, path[state])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> viterbi(observations,</span><br><span class="line">                   states,</span><br><span class="line">                   start_probability,</span><br><span class="line">                   transition_probability,</span><br><span class="line">                   emission_probability)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(example())</span><br><span class="line"></span><br><span class="line">print(<span class="string">'\n訣竅: 從最後一天推算，\n1. Day3 機率最大的那條路徑\n2. 其Day2 機率最大那條路徑\n3. 的最可能Day1'</span>)</span><br></pre></td></tr></table></figure><p>所以说 逐渐增加长度，每增加一次长度，之后再重新算一遍在这个长度下最后一个位置的转换概率，计算到最后一位时，就知道了每个位置的最大概率。</p><p>结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Day 1(walk): </span><br><span class="line">Rainy 0.06 = 0.6 * 0.1</span><br><span class="line">Sunny 0.24 = 0.4 * 0.6</span><br><span class="line">_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</span><br><span class="line">V:  [&#123;&apos;Rainy&apos;: 0.06, &apos;Sunny&apos;: 0.24&#125;]</span><br><span class="line">__________________________________________</span><br><span class="line">Day 2 (shop)</span><br><span class="line"></span><br><span class="line">當天Rainy:  0.0168 = 0.06 (前一天 Rainy) * 0.7 (Rainy to Rainy) * 0.4 (Rainy shop)</span><br><span class="line">當天Rainy:  0.0384 = 0.24 (前一天 Sunny) * 0.4 (Sunny to Rainy) * 0.4 (Rainy shop)</span><br><span class="line">當天Rainy  最大的是:  0.0384</span><br><span class="line"></span><br><span class="line">當天Sunny:  0.0054 = 0.06 (前一天 Rainy) * 0.3 (Rainy to Sunny) * 0.3 (Sunny shop)</span><br><span class="line">當天Sunny:  0.0432 = 0.24 (前一天 Sunny) * 0.6 (Sunny to Sunny) * 0.3 (Sunny shop)</span><br><span class="line">當天Sunny  最大的是:  0.0432</span><br><span class="line">__________________________________________</span><br><span class="line">Day 3 (clean)</span><br><span class="line"></span><br><span class="line">當天Rainy:  0.01344 = 0.0384 (前一天 Rainy) * 0.7 (Rainy to Rainy) * 0.5 (Rainy clean)</span><br><span class="line">當天Rainy:  0.00864 = 0.0432 (前一天 Sunny) * 0.4 (Sunny to Rainy) * 0.5 (Rainy clean)</span><br><span class="line">當天Rainy  最大的是:  0.01344</span><br><span class="line"></span><br><span class="line">當天Sunny:  0.00115 = 0.0384 (前一天 Rainy) * 0.3 (Rainy to Sunny) * 0.1 (Sunny clean)</span><br><span class="line">當天Sunny:  0.00259 = 0.0432 (前一天 Sunny) * 0.6 (Sunny to Sunny) * 0.1 (Sunny clean)</span><br><span class="line">當天Sunny  最大的是:  0.002592</span><br><span class="line">__________________________________________</span><br><span class="line">           0       1       2</span><br><span class="line">Rainy:  0.06000 0.03840 0.01344</span><br><span class="line">Sunny:  0.24000 0.04320 0.00259</span><br><span class="line">(0.01344, [&apos;Sunny&apos;, &apos;Rainy&apos;, &apos;Rainy&apos;])</span><br><span class="line"></span><br><span class="line">訣竅: 從最後一天推算，</span><br><span class="line">1. Day3 機率最大的那條路徑</span><br><span class="line">2. 其Day2 機率最大那條路徑</span><br><span class="line">3. 的最可能Day1</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://gist.github.com/yesseecity" target="_blank" rel="noopener">https://gist.github.com/yesseecity</a> 将步骤列出</p><p><a href="http://www.hankcs.com/nlp/hmm-and-segmentation-tagging-named-entity-recognition.html" target="_blank" rel="noopener">http://www.hankcs.com/nlp/hmm-and-segmentation-tagging-named-entity-recognition.html</a> 一个根据天气和推特的例子</p><p><a href="https://cloud.tencent.com/developer/article/1066699" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1066699</a> 马尔可夫模型简单理解</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> HMM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MAKER相关操作</title>
      <link href="/2019/08/21/MAKER%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/"/>
      <url>/2019/08/21/MAKER%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>####maker pipeline</p><p>1.Initial MAKER Analysis</p><p>2.Training Gene Prediction (snap, augustus) </p><p>3.Round 2 MAKER Analysis</p><p>4.Training Gene Prediction (snap, augustus)</p><p>5.Round 3 MAKER Analysis</p><p>6.Create Maker standard gene set file</p><p>7.PASA </p><a id="more"></a> <h5 id="1-Initial-MAKER-Analysis"><a href="#1-Initial-MAKER-Analysis" class="headerlink" title="1.Initial MAKER Analysis"></a>1.Initial MAKER Analysis</h5><p>#创建第一次运行maker需要的config文件 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maker -CTL</span><br></pre></td></tr></table></figure><p>#查看修改opts文件，运行maker</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># set of ESTs or assembled mRNA-seq in fasta format 三代转录数据</span><br><span class="line"></span><br><span class="line">est=/home/Data/avianbase/Prunella_strophita_BWA_INDEX/polished.hq.fasta</span><br><span class="line"></span><br><span class="line"># protein sequence file in fasta format (i.e. from mutiple oransisms) 从ensembl数据库中下载的human mus chicken Tae 数据 cat合并</span><br><span class="line"> </span><br><span class="line">protein=/home/Data/avianbase/Prunella_strophita_BWA_INDEX/ensembl/all/merge_pep.fa </span><br><span class="line"></span><br><span class="line"># 首次运行maker将est2 genome 与protein2genome 设置为1 ，即从头预测</span><br><span class="line"></span><br><span class="line">est2genome=1 </span><br><span class="line">protein2genome=1</span><br><span class="line"></span><br><span class="line"># 设置完成后执行</span><br><span class="line"></span><br><span class="line">nohup mpiexec -n 40 maker &gt; run_maker.log</span><br></pre></td></tr></table></figure><hr><p>#maker产生的结果</p><p>​    -Prunella_strophita_assemble_master_datastore_index.log 记录了每一个contig 比对的情况</p><p>使用maker的 gff3_merge     ### fasta_merge ###  对log文件进行注释信息的提取，在得到的 Prunella_strophita_assemble.maker.gff 文件中，包含了est , protein,  repeat masker 以及 maker 的注释结果</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># generate_gff.sh</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># sed -i 's/rndN/-/g' generate_gff.sh</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 每一轮用sed替换rndN信息</span></span><br><span class="line">gff3_merge -s -d Prunella_strophita_assemble_master_datastore_index.log &gt; Prunella_strophita_assemble.maker.gff</span><br><span class="line">fasta_merge -d Prunella_strophita_assemble_master_datastore_index.log</span><br><span class="line">gff3_merge -n -s -d Prunella_strophita_assemble_master_datastore_index.log &gt; Prunella_strophita_assemble.maker.noseq.gff</span><br><span class="line"><span class="meta">#</span><span class="bash"> est alignments</span></span><br><span class="line">awk '&#123; if ($2 == "est2genome") print $0 &#125;' Prunella_strophita_assemble.maker.noseq.gff &gt; Prunella_rndN.maker.est2genome.gff</span><br><span class="line"><span class="meta">#</span><span class="bash"> protein alignments</span></span><br><span class="line">awk '&#123; if ($2 == "protein2genome") print $0 &#125;' Prunella_strophita_assemble.maker.noseq.gff &gt;  Prunella_rndN.maker.protein2genome.gff</span><br><span class="line"><span class="meta">#</span><span class="bash"> repeat alignments</span></span><br><span class="line">awk '&#123; if ($2 ~ "repeat") print $0 &#125;' Prunella_strophita_assemble.maker.noseq.gff &gt;  Prunella_rndN.maker.repeats.gff</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> current dir </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /home/maker/20190718_version_maker/round1/Prunella_strophita_assemble.maker.output</span></span><br><span class="line"></span><br><span class="line">sed -i 's/rndN/rnd1/g' generate_gff.sh</span><br><span class="line">sh generate_gff.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对产生的gff统计基因数量与平均长度</span></span><br><span class="line">cat Prunella_strophita_assemble.maker.noseq.gff | awk '&#123; if ($3 == "gene") print $0 &#125;' | awk '&#123; sum += ($5 - $4) &#125; END &#123; print NR, sum / NR &#125;'</span><br><span class="line"></span><br><span class="line">sh gene_count.sh</span><br><span class="line">round1 result: 19711 7584.01</span><br></pre></td></tr></table></figure><h5 id="2-Training-Gene-Prediction"><a href="#2-Training-Gene-Prediction" class="headerlink" title="2.Training Gene Prediction"></a>2.Training Gene Prediction</h5><p>#将     snap.sh     busco.sh     gene_count.sh     cp到结果文件夹</p><p>通过训练基因模型再次注释提升预测的准确性</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## snap 基因结构预测</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## snap.sh</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line"></span><br><span class="line">mkdir snap</span><br><span class="line">mkdir snap/round1</span><br><span class="line">cd snap/round1</span><br><span class="line">maker2zff -x 0.25 -l 50 -d ../../Prunella_strophita_assemble_master_datastore_index.log</span><br><span class="line">rename genome Prunella_rnd1.zff.length50_aed0.25 genome*</span><br><span class="line">fathom Prunella_rnd1.zff.length50_aed0.25.ann Prunella_rnd1.zff.length50_aed0.25.dna -gene-stats &gt; gene-stats.log 2&gt;&amp;1</span><br><span class="line">fathom  Prunella_rnd1.zff.length50_aed0.25.ann Prunella_rnd1.zff.length50_aed0.25.dna -validate &gt; validate.log 2&gt;&amp;1</span><br><span class="line">fathom  Prunella_rnd1.zff.length50_aed0.25.ann Prunella_rnd1.zff.length50_aed0.25.dna -categorize 1000 &gt; categorize.log 2&gt;&amp;1</span><br><span class="line">fathom uni.ann uni.dna -export 1000 -plus &gt; uni-plus.log 2&gt;&amp;1</span><br><span class="line">mkdir params</span><br><span class="line">cd params</span><br><span class="line">forge ../export.ann ../export.dna &gt; ../forge.log 2&gt;&amp;1</span><br><span class="line">cd ..</span><br><span class="line">hmm-assembler.pl Prunella_rnd1.zff.length50_aed0.25 params &gt; Prunella_rnd1.zff.length50_aed0.25.hmm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BUSCO 基因结构预测</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">首先为了预测环境的准确性，将第一轮maker运行结果中的gff文件添加首末端1000bp的长度，可能会导致某些注释的mrna超过scaffold的边界，从而会导致bedtools报错，可以统计前后mrna的数量用以计算，而且此项影响较小。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## run_BUSCO.sh</span></span></span><br><span class="line">awk -v OFS="\t" '&#123; if ($3 == "mRNA") print $1, $4, $5 &#125;' Prunella_strophita_assemble.maker.noseq.gff | \</span><br><span class="line">  awk -v OFS="\t" '&#123; if ($2 &lt; 1000) print $1, "0", $3+1000; else print $1, $2-1000, $3+1000 &#125;' | \</span><br><span class="line">  bedtools getfasta -fi /home/Data/avianbase/Prunella_strophita_INDEX/Prunella_strophita_assemble.fa  -bed - -fo Prunella_rnd1.all.maker.transcripts1000.fasta</span><br><span class="line"></span><br><span class="line">mkdir busco</span><br><span class="line">cd busco</span><br><span class="line">BUSCO.py -i Prunella_rnd1.all.maker.transcripts1000.fasta -o Prunella_rnd1 -l /home/maker/software/maker/exe/busco/ave_odb9/ -m genome -c 8 --long -sp human -z --augustus_prameters '--progress=true'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> busco 的结果需要提取并修改为 augustus 物种进行下一轮的预测</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># BUSCO_rndN_number  oringin</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># species_name       target</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###############</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## generate_species.sh</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###############</span></span></span><br><span class="line"></span><br><span class="line">rename BUSCO_rndN_number species_name *</span><br><span class="line">sed -i 's/BUSCO_rndN_number/species_name/g' species_name_parameters.cfg</span><br><span class="line">sed -i 's/BUSCO_rndN_number/species_name/g' species_name_parameters.cfg.orig1</span><br><span class="line">mkdir ~/software/maker/exe/augustus/config/species/species_name</span><br><span class="line">cp species_name* ~/software/maker/exe/augustus/config/species/species_name</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> current dir /home/maker/20190718_version_maker/round1/Prunella_strophita_assemble.maker.output</span></span><br><span class="line">sh snap.sh</span><br><span class="line">sh run_busco.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /home/maker/20190718_version_maker/round/Prunella_strophita_assemble.maker.output/busco/run_0726_rnd1/augustus_output/retraining_parameters</span><br><span class="line">sed -i 's/rndN/rnd1/g' generate_species.sh</span><br><span class="line">sed -i 's/species_name/Prunella_chiecken_rnd1/g' generate_species.sh</span><br><span class="line">sh generate_species.sh</span><br></pre></td></tr></table></figure><p>#####3.Round 2 MAKER Analysis</p><p>将第一轮生成的gff结果中 est2genome.gff 和 protein2genome.gff 和 repeats.gff 以及 snap预测的基因模型中 hmm 文件输入第二轮的maker_opts.ctl</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cd /home/maker/maker_0720/round2</span><br><span class="line"></span><br><span class="line">maker -CTL</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将maker_opts文件中的 snap 与 Augustus 预测文件添加，将 est2genome.gff, protein2genome.gff,  repeats.gff 输入，将est2genome protein2genome 设置为0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">est_gff=/home/maker/20190704_version_maker/rnd2_data/Prunella_rnd1.all.maker.est2genome.gff   <span class="comment">#aligned ESTs or mRNA-seq from an external GFF3 file</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">genome=/home/Data/avianbase/Prunella_strophita_BWA_INDEX/Prunella_strophita_assemble.fa </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">protein_gff=/home/maker/20190704_version_maker/rnd2_data/Prunella_rnd1.all.maker.protein2genome.gff  <span class="comment">#aligned protein homology evidence from an external GFF3 file</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">rm_gff=/home/maker/20190704_version_maker/rnd2_data/Prunella_rnd1.all.maker.repeats.gff <span class="comment">#pre-identified repeat elements from an external GFF3 file</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">snaphmm=/home/maker/20190704_version_maker/rnd2_data/Prunella_rnd1.zff.length50_aed0.25.hmm <span class="comment">#SNAP HMM file</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">augustus_species=Prunell_strophita <span class="comment">#Augustus gene prediction species model</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">max_dna_len=300000 <span class="comment">#length for dividing up contigs into chunks (increases/decreases memory usage)</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">split_hit=20000 <span class="comment">#length for the splitting of hits (expected max intron size for evidence alignments)</span></span></span><br><span class="line"></span><br><span class="line">nohup mpiexec -n 40 maker &gt; run_maker.log</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># generate_gff.sh</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># sed -i 's/rndN/-/g' generate_gff.sh</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 每一轮用sed替换rndN信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 因为预测结果中使用基因结构预测</span></span><br><span class="line"></span><br><span class="line">gff3_merge -s -d Prunella_strophita_assemble_master_datastore_index.log &gt; Prunella_strophita_assemble.maker.gff</span><br><span class="line">fasta_merge -d Prunella_strophita_assemble_master_datastore_index.log</span><br><span class="line">gff3_merge -n -s -d Prunella_strophita_assemble_master_datastore_index.log &gt; Prunella_strophita_assemble.maker.noseq.gff</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> est alignments</span></span><br><span class="line">awk '&#123; if ($2 ~ "est2genome") print $0 &#125;' Prunella_strophita_assemble.maker.noseq.gff &gt; Prunella_rndN.maker.est2genome.gff</span><br><span class="line"><span class="meta">#</span><span class="bash"> protein alignments</span></span><br><span class="line">awk '&#123; if ($2 ~ "protein2genome") print $0 &#125;' Prunella_strophita_assemble.maker.noseq.gff &gt;  Prunella_rndN.maker.protein2genome.gff</span><br><span class="line"><span class="meta">#</span><span class="bash"> repeat alignments</span></span><br><span class="line">awk '&#123; if ($2 ~ "repeat") print $0 &#125;' Prunella_strophita_assemble.maker.noseq.gff &gt;  Prunella_rndN.maker.repeats.gff</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -i 's/rndN/rnd2/g' generate_gff.sh</span><br><span class="line">sh generate_gff.sh</span><br><span class="line"></span><br><span class="line">sh gene_count.sh</span><br><span class="line">18227 13821.9</span><br><span class="line"><span class="meta">#</span><span class="bash"> 由于第一轮是根据已有信息预测，长度在第二轮得到了修正</span></span><br></pre></td></tr></table></figure><h5 id="4-Training-Gene-Prediction"><a href="#4-Training-Gene-Prediction" class="headerlink" title="4.Training Gene Prediction"></a>4.Training Gene Prediction</h5><p># 与第二步相同, 将 snap.sh     busco.sh     gene_count.sh     cp到结果文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed -i 's/rnd1/rnd2/g' *.sh</span><br><span class="line">sed -i 's/round1/round2/g' snap.sh</span><br><span class="line">sed -i 's/00rnd1/01_rnd2/g' run_BUSCO.sh</span><br><span class="line">sh snap.sh</span><br><span class="line">sh run_BUSCO.sh</span><br><span class="line">cd busco/augustus_output/retraining_paramters</span><br><span class="line">sh generate_species.sh</span><br></pre></td></tr></table></figure><p>#####5.Round 3 MAKER analysis</p><p>将第二轮maker结果输入maker_opts.ctl 重复第三步</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim maker_opts.ctl</span><br><span class="line">nohup mpiexec -n 40 maker &gt; run_maker.log</span><br><span class="line">sh generate_gff.sh</span><br></pre></td></tr></table></figure><p>#####6.Create Maker standard gene set file</p><p># 对第三轮的maker 结果</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">awk -v OFS="\t" '&#123; if ($3 == "mRNA") print $1, $4, $5 &#125;' /home/maker/20190704_version_maker/02_rnd3/Prunella_strophita_assemble.output/Prunella_strophita_assemble.maker.noseq.gff | \</span><br><span class="line">  bedtools getfasta -fi /home/Data/avianbase/Prunella_strophita_INDEX/Prunella_strophita_assemble.fa -bed - -fo Prunella_rnd3.all.maker.fasta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir busco</span><br><span class="line">cd busco</span><br><span class="line"><span class="meta">#</span><span class="bash"> 不再再添加前后1000bp的片段，同时运行busco时将model改为 transcriptome </span></span><br><span class="line">run_BUSCO.py -i Prunella_rnd3.all.maker.transcripts.fasta -o Prunella_rnd3 -l /home/maker/software/busco-master/aves_odb9/  -m transcriptome -c 8 -sp Prunella_chicken_rnd2 -z --augustus_parameters='--progress=true'</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看busco的完整性检查结果</span></span><br><span class="line">less run_Prunella_rnd3/short_summary_Prunella_rnd3.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> gne count</span></span><br><span class="line">sh gene_count.sh</span><br><span class="line">18148 13917.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提取结果中maker注释的gff部分</span></span><br><span class="line">perl get_maker_gff.pl Prunella_strophita_assemble.maker.noseq.gff Prunella_strophita_assemble.maker.only.final.noseq.gff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 替换gff中的ID</span></span><br><span class="line">maker_map_ids --prefix Prunella --justify 5 Prunella_strophita_assemble.maker.noseq.gff &gt;</span><br><span class="line">Prunella_rnd3.maker.name.map</span><br><span class="line"></span><br><span class="line">map_gff_ids Prunella_rnd3.maker.name.map Prunella_strophita_assemble.maker.only.final.noseq.gff</span><br></pre></td></tr></table></figure><table><thead><tr><th>Gene number</th><th>Gene average length</th><th>Info</th></tr></thead><tbody><tr><td>19711</td><td>7584.01</td><td>Round 1</td></tr><tr><td>18227</td><td>13821.9</td><td>Round 2</td></tr><tr><td>18148</td><td>13917.2</td><td>Round 3</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep 'three_prime_UTR' Prunella_strophita_assemble.maker.only.final.noseq.gff | wc -l</span><br><span class="line">2752</span><br><span class="line">grep 'five_prime_UTR' Prunella_strophita_assemble.maker.only.final.noseq.gff | wc -l</span><br><span class="line">2494</span><br></pre></td></tr></table></figure><h5 id="7-PASA-prediect-utr-region"><a href="#7-PASA-prediect-utr-region" class="headerlink" title="7.PASA prediect utr region"></a>7.PASA prediect utr region</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> gmap cds2gff</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> clean cds 去除低质量序列</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /data/maker/PASA_20/data</span></span><br><span class="line">/home/maker/software/PASApipeline/bin/seqclean XZ15142.hq.fasta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> custom alignments gff  首先对基因组index然后比对生成 cds 和 gene 模式gff</span></span><br><span class="line">/home/maker/software/PASApipeline/scripts/process_GMAP_alignments_gff3_chimeras_ok.pl --genome Prunella_strophita_assemble.fa  --transcripts XZ15142.hq.fasta.clean --CPU 2 -N 2  -I 500000  &gt; gmap.spliced_alignments.gff3</span><br><span class="line"></span><br><span class="line">gmap -D . -d Prunella_strophita_assemble.fa.gmap -f 2 -n 2 -x 50 -t 2 -B 5  --max-intronlength-middle=500000 --max-intronlength-ends=500000 XZ15142.hq.fasta.clean</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Running Alignment Assembly 将基因组与cds信息比对</span></span><br><span class="line">/home/maker/software/PASApipeline/Launch_PASA_pipeline.pl -c sqlite_conf/alignAssembly.config -C -r -R -g data/Prunella_strophita_assemble.fa -t data/XZ15142.hq.fasta.clean -T -u data/XZ15142.hq.fasta --ALIGNERS blat --CPU 2 -N 2 --IMPORT_CUSTOM_ALIGNMENTS_GFF3 data/gmap.spliced_alignments.gff3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Building comprehensive transcriptome database 将结果输入到sqlite数据库</span></span><br><span class="line">~/software/PASApipeline/scripts/build_comprehensive_transcriptome.dbi -c sqlite_conf/alignAssembly.config -t data/XZ15142.hq.fasta.clean</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> First round, using pre-existing gene structure annotations 对 gff进行update</span></span><br><span class="line">  ~/software/PASApipeline/Launch_PASA_pipeline.pl -c sqlite_conf/annotCompare.config -g data/Prunella_strophita_assemble.fa -t data/XZ15142.hq.fasta.clean -A -L --annots data/gmap_gene.gff3 --CPU 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Second round</span></span><br><span class="line">~/software/PASApipeline/Launch_PASA_pipeline.pl -c sqlite_conf/annotCompare.config -g data/Prunella_strophita_assemble.fa -t data/XZ15142.hq.fasta.clean -A -L --annots  --CPU 2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Markdown, maker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/08/13/hello-world/"/>
      <url>/2019/08/13/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
